(FILECREATED "13-JUN-83 01:00:10" <BLISPUSERS>BSPAUX.;5 2950   

      changes to:  (VARS BSPAUXCOMS)
		   (FNS BSPOUTPUTSTREAM)

      previous date: "27-MAR-83 08:45:08" <BLISPUSERS>BSPAUX.;4)


(* Copyright (c) 1983 by Xerox Corporation)

(PRETTYCOMPRINT BSPAUXCOMS)

(RPAQQ BSPAUXCOMS [(FNS BLOCK BSPOUTPUTSTREAM)
		   (COMS (DECLARE: DONTCOPY (RECORDS BSPSOCKET)
				   (MACROS BSPBIN BSPBOUT))
			 (INITRECORDS BSPSOCKET)
			 (FNS BSPFORCEOUTPUT BSPGETMARK BSPOPENP CREATEBSPSTREAM \BSP.FLUSHINPUT 
			      BSPSOUT))
		   (DECLARE: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA)
											 (NLAML)
											 (LAMA])
(DEFINEQ

(BLOCK
  [LAMBDA (MSECSWAIT WAKEDEFAULT DONT.RESET.TIMER)
                                   (* lmm "19-JAN-83 20:52")
    (COND
      ((AND (NOT DONT.RESET.TIMER)
	    (FIXP MSECSWAIT))
	(DISMISS MSECSWAIT)
	NIL])

(BSPOUTPUTSTREAM
  [LAMBDA (SOC)                    (* lmm "13-JUN-83 00:49")
    (fetch OUTJ of SOC])
)
(DECLARE: DONTCOPY 
[DECLARE: EVAL@COMPILE 

(DATATYPE BSPSOCKET (INJ OUTJ CONN (CONNID FIXP))
		    CONNID _(SETQ \LASTBSPCONN (ADD1 (OR (FIXP (GETTOPVAL (QUOTE \LASTBSPCONN)))
							 0))))
]
(/DECLAREDATATYPE (QUOTE BSPSOCKET)
		  (QUOTE (POINTER POINTER POINTER FIXP)))

(DECLARE: EVAL@COMPILE 

(PUTPROPS BSPBIN MACRO ((BSPSOC)
			(\BIN (ffetch INJ of BSPSOC))))

(PUTPROPS BSPBOUT MACRO ((BSPSOC BYTE)
			 (\BOUT (ffetch OUTJ of BSPSOC)
				BYTE)))
)
)
(/DECLAREDATATYPE (QUOTE BSPSOCKET)
		  (QUOTE (POINTER POINTER POINTER FIXP)))
(DEFINEQ

(BSPFORCEOUTPUT
  [LAMBDA (BSPSOC)                 (* lmm "19-JAN-83 22:23")
    (FORCEOUT (CADR (fetch CONN of BSPSOC])

(BSPGETMARK
  [LAMBDA (BSPSOC)                 (* lmm "19-JAN-83 22:23")
    (PUPGETMARK (fetch INJ of BSPSOC])

(BSPOPENP
  [LAMBDA (BSPSOC)                 (* lmm "19-JAN-83 22:23")
    (CHECKCONNECTION (fetch CONN of BSPSOC])

(CREATEBSPSTREAM
  [LAMBDA (SOCK OTHERPUPHANDER ERRORHANDLER IOTIMEOUT IOTIMEOUTFN)
                                   (* lmm "27-MAR-83 08:44")
    (create BSPSOCKET
	    CONN _(SETQ SOCK (MAKENEWCONNECTION (ETHERHOSTNAME (CAR SOCK))
						(QUOTE PUP)
						(CDR SOCK)))
	    INJ _(OPNJFN (CAR SOCK))
	    OUTJ _(OPNJFN (CADR SOCK])

(\BSP.FLUSHINPUT
  [LAMBDA (BSPSOC)                 (* lmm "19-JAN-83 22:25")
    (CLEARBUF (CAR (fetch CONN of BSPSOC])

(BSPSOUT
  [LAMBDA (SOCKET STR)             (* lmm "19-JAN-83 23:45")
    (for I from 1 to (NCHARS STR) do (BSPBOUT SOCKET (NTHCHARCODE STR I])
)
(DECLARE: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS 

(ADDTOVAR NLAMA )

(ADDTOVAR NLAML )

(ADDTOVAR LAMA )
)
(PUTPROPS BSPAUX COPYRIGHT ("Xerox Corporation" 1983))
(DECLARE: DONTCOPY
  (FILEMAP (NIL (676 1044 (BLOCK 688 . 917) (BSPOUTPUTSTREAM 921 . 1041)) (1635 2730 (BSPFORCEOUTPUT 
1647 . 1785) (BSPGETMARK 1789 . 1918) (BSPOPENP 1922 . 2055) (CREATEBSPSTREAM 2059 . 2412) (
\BSP.FLUSHINPUT 2416 . 2554) (BSPSOUT 2558 . 2727)))))
STOP
