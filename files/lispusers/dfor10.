(FILECREATED "14-Aug-84 02:10:32" <NEWLISP.LISPUSERS>DFOR10..1 3575   

      changes to:  (VARS DFOR10COMS)

      previous date: "23-OCT-83 23:29:44" <LISPUSERS>DFOR10..8)


(* Copyright (c) 1982, 1983, 1984 by Xerox Corporation. All rights reserved.)

(PRETTYCOMPRINT DFOR10COMS)

(RPAQQ DFOR10COMS [(FNS GETSTREAM BIN BOUT OPENSTREAM STREAMP)
		   (RECORDS STREAM)
		   (PROP 10MACRO \BIN \BOUT KNOWNSMALLP BIN2 BOUT2 \BIN2 \BOUT2)
		   [VARS (FILESTREAMS (LIST (HARRAY 10]
		   (DECLARE: EVAL@COMPILE (P (* some old alice garbage)
					     (REMPROP (QUOTE STREAMP)
						      (QUOTE CTYPE)))
			     DONTCOPY
			     (P (FILESLOAD (FROM LISPUSERS)
					   CJSYS])
(DEFINEQ

(GETSTREAM
  [LAMBDA (FILE ACCESS)            (* lmm "23-OCT-83 23:18")
    (OR ACCESS (SETQ ACCESS (QUOTE INPUT)))
    (PROG NIL
          (COND
	    ((STREAMP FILE)
	      (RETURN FILE)))
          (RETURN (COND
		    [(CDR (ASSOC ACCESS (OR (GETHASH FILE FILESTREAMS)
					    (GETHASH (SETQ FILE (OPENP (OR FILE
									   (SELECTQ ACCESS
										    (OUTPUT (OUTPUT))
										    (INPUT)))
								       ACCESS))
						     FILESTREAMS]
		    (T (PROG [(STR (create STREAM
					   FULLNAME _ FILE
					   JFN _(OPNJFN FILE ACCESS]
			     [AND (NEQ FILE T)
				  (WHENCLOSE FILE (QUOTE BEFORE)
					     (FUNCTION (LAMBDA (X)
						 (PUTHASH X NIL FILESTREAMS]
			     (PUTHASH FILE (CONS (CONS ACCESS STR)
						 (GETHASH FILE FILESTREAMS))
				      FILESTREAMS)
			     (RETURN STR])

(BIN
  [LAMBDA (FILE)                   (* lmm "23-OCT-83 23:09")
    (\BIN (if (type? STREAM FILE)
	      then FILE
	    else (GETSTREAM FILE (QUOTE INPUT])

(BOUT
  [LAMBDA (STREAM BYTE)            (* lmm "23-OCT-83 23:26")
    (\BOUT (if (type? STREAM STREAM)
	       then STREAM
	     else (GETSTREAM STREAM (QUOTE OUTPUT)))
	   BYTE])

(OPENSTREAM
  [LAMBDA (FILE ACCESS RECOG BYTESIZE MACHINE.DEPENDENT.PARAMETERS)
                                   (* lmm "23-OCT-83 23:11")
    (GETSTREAM (OPENFILE FILE ACCESS RECOG BYTESIZE MACHINE.DEPENDENT.PARAMETERS)
	       ACCESS])

(STREAMP
  [LAMBDA (STR)                    (* lmm "23-OCT-83 22:53")
    (type? STREAM STR])
)
[DECLARE: EVAL@COMPILE 

(DATATYPE STREAM ((FULLNAME POINTER)
		  (JFN BITS 18)))
]
[/DECLAREDATATYPE (QUOTE STREAM)
		  (QUOTE (POINTER (BITS 18]

(PUTPROPS \BIN 10MACRO ((X)
			(JS BIN (ffetch JFN of X)
			    NIL NIL 2)))

(PUTPROPS \BOUT 10MACRO ((STREAM BYTE)
			 (JS BOUT (ffetch JFN of STREAM)
			     (KNOWNSMALLP BYTE)
			     NIL 2)))

(PUTPROPS KNOWNSMALLP 10MACRO ((X)
			       X))

(PUTPROPS BIN2 10MACRO (OPENLAMBDA (STREAM)
				   (LOGOR (LLSH (BIN STREAM)
						8)
					  (BIN STREAM))))

(PUTPROPS BOUT2 10MACRO (OPENLAMBDA (STREAM WORD)
				    (BOUT STREAM (LRSH WORD 8))
				    (BOUT STREAM (LOGAND WORD 255))))

(PUTPROPS \BIN2 10MACRO (OPENLAMBDA (STREAM)
				    (LOGOR (LLSH (\BIN STREAM)
						 8)
					   (\BIN STREAM))))

(PUTPROPS \BOUT2 10MACRO (OPENLAMBDA (STREAM WORD)
				     (\BOUT STREAM (LRSH WORD 8))
				     (\BOUT STREAM (LOGAND WORD 255))))

(RPAQ FILESTREAMS (LIST (HARRAY 10)))
(DECLARE: EVAL@COMPILE 
(* some old alice garbage)
(REMPROP (QUOTE STREAMP)
	 (QUOTE CTYPE))
DONTCOPY 
(FILESLOAD (FROM LISPUSERS)
	   CJSYS)
)
(PUTPROPS DFOR10 COPYRIGHT ("Xerox Corporation" 1982 1983 1984))
(DECLARE: DONTCOPY
  (FILEMAP (NIL (702 2335 (GETSTREAM 714 . 1552) (BIN 1556 . 1745) (BOUT 1749 . 1962) (OPENSTREAM 1966 . 2221) (STREAMP 2225 . 2332)))
))
STOP
